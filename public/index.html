<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Page Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO
    crossorigin=anonymous>
  <link rel="stylesheet" href="style.css">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  <script src="main.js"></script>
</head>

<body>
  <div id="mainContainer" class="bg-dark">
    <div id="paintSection" class="bg-danger">
      <div id="canvasWindow" class="bg-warning">
        <div style="height:2000px; width:2000px; overflow: hidden;">
        <canvas width="2000" height="2000" id="lower"></canvas>
        <canvas width="2000" height="2000" id="upper"></canvas>
        </div>
      </div>
      <div id="toolSection" class="bg-info"></div>
      
      <div id="paletteSection" class="bg-dark">
        <div id="rgb" class="slidersContainer bg-info mt-1">
          <button id="zoom1x">zoom 1x</button>
          <button id="zoom2x">zoom 2x</button>
          <div class="col-11 mx-auto mt-2">
            <label class="row"><small class="col-1">Size</small> <input type="range" class="col-9 ml-auto"> </label>
            <label class="row"><small class="col-1">Zoom</small> <input type="range" class="col-9 ml-auto"> </label>
          </div>
        </div>
        <div id="hsv" class="slidersContainer bg-light mt-1">
          <button id="">HSV</button>
          <button id="">RGB</button>
          <div class="col-12 mx-auto mt-2">
          <label>R <input type="range" class="col-9"> <small>255</small></label>
          <label>B <input type="range" class="col-9"> <small>255</small></label>
          <label>G <input type="range" class="col-9"> <small>255</small></label>
          <label>A <input type="range" class="col-9"> <small>100</small></label>
          </div>
        </div>
        <img id="palette" src="palette.png">
      </div>
    </div>
    <div id="userSection" class="bg-success">
      <div id="roomAction" class=" mx-2 mt-2 bg-info"></div>
      <div id="userList" class=" mx-2 my-2 bg-light p-2">
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
        <p class="mb-0 font-weight-bold text">bobbey</p>
      </div>
      <div id="chatLog" class=" mx-2 p-2 bg-dark">
        <div id="messages">
          <p class="mb-0 text text-others">bobbey (9:06):</p>
          <p class="mb-0 text text-messages">asdakslfk</p>
          <p class="mb-0 text text-yours">You (9:06):</p>
          <p class="mb-0 text text-messages">dssalkdjasl</p>
          <p class="mb-0 text text-others">bobbey (9:06):</p>
          <p class="mb-0 text text-messages">lslslslsslsl</p>
        </div>
        <input class="col-12" type="text" name="" id="" style="font-size: 12px;">
      </div>
    </div>
  </div>

  <script>
    // const ctx = $('#bCanvas')[0].getContext('2d');
    var x;
    var y;

    var lower = $('#lower').get(0).getContext('2d');
    var upper = $('#upper').get(0).getContext('2d');
    var offset = $('#upper').offset();
    var scroll = { top: 0, left: 0 }
    console.log(offset)
    var dragging = false;

    function drawStroke(ctx) {
      var i;
      ctx.strokeStyle = 'rgba(0,0,0,0.5)';
      ctx.lineWidth = 10;
      ctx.beginPath();
      ctx.moveTo(x[0], y[0]);
      for (i = 1; i < x.length; i++) {
        ctx.lineTo(x[i], y[i]);
      }
      ctx.stroke();
    }

    $('#upper').mousedown(function (e) {
      const mousePos = getMousePos(upper.canvas, e)
      const zoom = $(upper.canvas).css('zoom')
      x = [mousePos.x];
      y = [mousePos.y];
      dragging = true
    });

    $('#upper').mousemove(function (e) {
      if (dragging) {
        const mousePos = getMousePos(upper.canvas, e)
        const zoom = $(upper.canvas).css('zoom')
        x.push(mousePos.x);
        y.push(mousePos.y);
        upper.clearRect(0, 0, upper.canvas.width, upper.canvas.height);
        drawStroke(upper);
      }
    });

    $('#upper').mouseup(function (e) {
      dragging = false;
      upper.clearRect(0, 0, upper.canvas.width, upper.canvas.height);
      console.log(x)
      drawStroke(lower);
    });

    function getMousePos(canvas, evt) {
      const rect = canvas.getBoundingClientRect();
      const zoom = $(canvas).css('zoom')
      return {
        x: evt.clientX  / zoom - rect.left,
        y: evt.clientY / zoom - rect.top
      };
    }
    function getNonZoomedMousePos(canvas, evt) {
      const rect = canvas.getBoundingClientRect();
      return {
        x: evt.clientX - rect.left,
        y: evt.clientY - rect.top
      };
    }



    $('#zoom1x').click(function() {handleZoom(1)})
    $('#zoom2x').click(function() {handleZoom(2)})

    function handleZoom(zoomVal) {
      $('#upper, #lower').css('zoom', `${zoomVal}00%`)
      $(upper.canvas).css('top', `${-2000 - 6 / zoomVal}px`)
    }
  </script>
</body>

</html>